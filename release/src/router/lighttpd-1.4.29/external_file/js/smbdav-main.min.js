var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_modal_url,g_modal_window_width=200,g_modal_window_height=80,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,g_folder_array=null,g_file_array=null,g_opening_uid="",g_on_button_animation=0,g_on_rescan_samba=0,g_support_lan=["en-us","zh-tw","zh-cn","cz","pl","ru","de","fr","tr","th","ms","no","fi","da","sv","br","jp","es","it","uk"],g_current_locktoken="",g_mouse_x=0,g_mouse_y=
0,g_fileview_only=0,g_btnSelect_right_position=0,client=new davlib.DavClient;client.initialize();g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;function isListView(){return g_storage.getl("listview")==void 0?1:g_storage.getl("listview")}function isAiModeView(){return g_storage.get("aimode")==void 0?-1:g_storage.get("aimode")}function getAiMode(){return g_storage.get("aimode")==void 0?-1:g_storage.get("aimode")}
function openLoginWindow(c){var b=$("div#modalWindow"),d=b.css("display"),a=function(){var a=$("#table_login input#username").val(),b=$("#table_login input#password").val(),a="Basic "+Base64.encode(a+":"+b);closeJqmWindow(0);doLOGIN(c,a)};g_modal_url="";g_modal_window_width=380;g_modal_window_height=120;if(c=="/")$("#jqmTitleText").text(m.getString("title_login")+" - AiCloud");else{var f=mydecodeURI(c);$("#jqmTitleText").text(m.getString("title_login")+" - "+f.substring(0,35))}d=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror"));
$("#jqmMsg").css("display",d);d="";d+='<table id="table_login" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;table-layout: fixed;">';d+="<tr>";d+="<td>";d+='<form name="form_login">';d+='<fieldset width="120px">';d+="<table>";d+="<tr>";d+='<td><label id="username">'+m.getString("title_username")+'</label></td><td><input name="username" type="text" id="username" autocapitalize="off" style="width:250px"></td>';d+="</tr>";d+="<tr>";d+='<td><label id="password">'+
m.getString("title_password")+'</label></td><td><input name="password" type="password" id="password" style="width:250px"></td>';d+="</tr>";d+="</table>";d+="</fieldset>";d+="</form>";d+="</td>";d+="</tr>";d+='<tr style="height:10px"></tr>';d+="<tr>";d+="<td>";d+='<div class="table_block_footer" style="text-align:right">';d+='<button id="ok" class="btnStyle">'+m.getString("btn_ok")+"</button>";d+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";d+="</div>";d+="</td>";d+=
"</tr>";d+="</table>";$("#jqmContent").empty();$(d).appendTo($("#jqmContent"));$("#table_login input#password").keydown(function(b){b.keyCode==13&&a()});$("#table_login #ok").click(function(){a()});$("#table_login #cancel").click(function(){closeJqmWindow(0)});b&&b.jqmShow()}
function doRescanSamba(){var c=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(c,function(b){b[0]==2&&(b=g_storage.getl("rescan_samba_timer"),b!=0&&clearInterval(b),g_storage.setl("onRescanSamba",1),g_storage.setl("onRescanSambaCount",0),g_storage.setl("rescan_samba_timer",0),g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(c){var b=addPathSlash(g_storage.get("openurl")),d=b+myencodeURI(c),a=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&c==$(this).attr("title")&&(a=1,alert(m.getString("folder_already_exist_msg")))});a!=1&&client.MKCOL(d,function(a){a[0]==2?(doPROPFIND(b),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(c,b){var d=0,a=addPathSlash(g_storage.get("openurl")),f=a+b;$("a#list_item").each(function(){b==myencodeURI($(this).attr("title"))&&(d=1,$(this).attr("isdir")=="1"?alert(m.getString("folder_already_exist_msg")):alert(m.getString("file_already_exist_msg")))});d!=1&&client.LOCK(c,"",function(b,e,d){if(b!="201")alert(m.getString("msg_already_lock"));else{var j=getLockToken(d);client.MOVE(c,f,function(b){b[0]==2?(doPROPFIND(a),closeJqmWindow(0)):alert(m.getString(b));client.UNLOCK(c,
j,function(a){a!=204&&alert("Unlock error: "+a)})},null,"F",j)}},null)}function getFileViewHeight(){return $("#fileview").height()-20}function closePopupmenu(){$(".popupmenu").remove()}function confirmCancelUploadFile(){if(g_storage.get("isOnUploadFile")==1){if(confirm(m.getString("msg_confirm_cancel_upload"))!=!0)return 0;$("#upload_panel iframe")[0].contentWindow.stop_upload()}return 1}
function closeJqmWindow(c){g_reload_page=c;c=$("div#modalWindow");$("iframe",c).attr("src","");c&&c.jqmHide();showHideLoadStatus(!1)}function resizeJqmWindow(c,b){var d=$(".jqmWindow");d&&(d.css("width",c+"px"),d.css("height",b+"px"))}function fullscreenJqmWindow(){var c=$("div#modalWindow");c&&(c.css("left","0px"),c.css("top","0px"),c.css("width",window.width+"px"),c.css("height",window.height+"px"))}
function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(c){c[0]==2&&(g_storage.set("openhostuid","0"),window.location.reload())})},0)}function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}
function doPROPFINDMEDIALIST(c,b,d,a,f,h,e,g,j,k){if(client!=null){showHideLoadStatus(!0);try{client.PROPFINDMEDIALIST(c,function(f,h,l){if(f){if(f==207){cancelSelectMode();closeUploadPanel();var k=content2XMLDOM(l),l=1,q=f=0,h="Idle";b||(g_folder_array=null,g_folder_array=[],g_file_array=null,g_file_array=[]);k&&(l=1,f=parseInt(k.documentElement.getAttribute("qcount")),parseInt(k.documentElement.getAttribute("qstart")),q=parseInt(k.documentElement.getAttribute("qend")),h=k.documentElement.getAttribute("scan_status"),
parserPropfindXML(k,c,b));k="";g_ui_mode.get()==6?(l=0,k="goto:music_album"):g_ui_mode.get()==7&&(l=0,k="goto:music_artist");g_list_view.get()==1?createListView($("#main_right_container #fileview"),l,k,g_folder_array,g_file_array,onMouseDownListDIVHandler):createThumbView($("#main_right_container #fileview"),l,k,g_folder_array,g_file_array,onMouseDownThumbDIVHandler);f>q&&(q+=1,l=q+50,l>f&&(l=f),q="<div class='nextDiv' start='"+q+"' end='"+l+"'><span>",k=m.getString("title_next_query"),k=k.replace("%s",
l),k=k.replace("%s",f),q+=k,q+="</span></div>",$("#main_right_container #fileview").append(q),$(".nextDiv").click(function(){doPROPFINDMEDIALIST(c,!0,null,a,$(this).attr("start"),$(this).attr("end"),e,g,j)}));h=="Scanning"?($("#main_right_container #hintbar").text(m.getString("msg_dms_scanning")),$("#main_right_container #hintbar").show()):$("#main_right_container #hintbar").hide();g_storage.set("aimode",a);$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","block");$("div#btnNewDir").css("display",
"none");$("div#btnPlayImage").css("display",a==1?"block":"none");$("div#boxSearch").css("display","block");g_storage.set("openurl",c);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));$("div#boxSearch").attr("uhref",c);$("div#boxSearch").attr("qtype",a);adjustLayout();closeJqmWindow(0);d!=void 0&&d()}else f==501?doPROPFINDMEDIALIST(c):f==503?show_hint_no_mediaserver():
f==401?setTimeout(function(){openLoginWindow(c)},2E3):alert(m.getString(f));showHideLoadStatus(!1)}},null,a,f,h,e,g,j,k),resetTimer()}catch(l){alert("catch error: "+l)}}}
function parserPropfindXML(c,b,d){if(c){d==!1&&(g_file_array=g_folder_array=null);g_folder_array==null&&(g_folder_array=[]);g_file_array==null&&(g_file_array=[]);for(var a,f,h,e=c.documentElement.childNodes,c=0;c<e.length;c++){var g="",j="",k="",l="",p="",v="",w="",x="",q="",y="",z="",A="",B="",C;h="";for(var D="0",r="",s="0",t=e[c].childNodes,d=0;d<t.length;d++)if(t[d].nodeType==1&&t[d].nodeName=="D:propstat"){var o=t[d].childNodes;for(a=0;a<o.length;a++)if(o[a].nodeName=="D:prop"){var n=o[a].childNodes;
for(f=0;f<n.length;f++)if(!(n[f].childNodes.length<=0))if(n[f].nodeName=="D:getcontenttype")j=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getuniqueid")k=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getonline")v=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getlastmodified")w=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getcontentlength")x=String(size_format(parseInt(n[f].childNodes[0].nodeValue)));else if(n[f].nodeName=="D:getmac")y=
String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getip")q=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:gettype")z=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getattr"){var u=n[f].childNodes;for(h=0;h<u.length;h++)if(u[h].nodeName=="D:readonly")A=u[h].childNodes[0].nodeValue;else if(u[h].nodeName=="D:hidden")B=u[h].childNodes[0].nodeValue}else if(n[f].nodeName=="D:getuseragent")h=String(n[f].childNodes[0].nodeValue),g_storage.set("user_agent",h);else if(n[f].nodeName==
"D:getroutersync")D=String(n[f].childNodes[0].nodeValue);else if(n[f].nodeName=="D:getmetadata"){u=n[f].childNodes;for(h=0;h<u.length;h++)if(u[h].nodeName=="D:title")r=u[h].childNodes[0].nodeValue;else if(u[h].nodeName=="D:thumb")s=u[h].childNodes[0].nodeValue}}}else t[d].nodeType==1&&t[d].nodeName=="D:href"&&(g=String(t[d].childNodes[0].nodeValue),a="",g.match(/^http/)&&(a=window.location.protocol+"//"+window.location.host),f=a+addPathSlash(b),g!=f?(g=g.replace(a,""),l=g.substring(g.lastIndexOf("/")+
1,g.length),l!=""?(C=l,p=l=mydecodeURI(l),a=g_list_view.get()==0?12:45,p.length>a&&(p=p.substring(0,a)+"...")):g=""):g="");g!=""&&(j=="httpd/unix-directory"?g_folder_array.push({contenttype:j,href:g,name:l,uname:C,shortname:p,online:v,time:w,size:x,ip:q,mac:y,uid:k,type:z,freadonly:A,fhidden:B,routersyncfolder:D,matadatatitle:r,thumb:s}):g_file_array.push({contenttype:j,href:g,name:l,uname:C,shortname:p,online:v,time:w,size:x,ip:q,mac:y,uid:k,type:z,freadonly:A,fhidden:B,routersyncfolder:D,matadatatitle:r,
thumb:s}))}}}function content2XMLDOM(c){if(c=="")return null;var b=null,b=null;if(window.DOMParser)b=new DOMParser,b=b.parseFromString(c,"text/xml");else if(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(c),!b.documentElement)return alert("Fail to load xml!"),showHideLoadStatus(!1),null;return b}
function doPROPFIND(c,b,d){if(client!=null){showHideLoadStatus(!0);try{client.PROPFIND(c,d,function(a,d,e){if(a){if(a==207){cancelSelectMode();closeUploadPanel();var g=content2XMLDOM(e);if(g){a=g.documentElement.getAttribute("qtype");g.documentElement.getAttribute("readonly");d=g.documentElement.getAttribute("ruser");g.documentElement.getAttribute("computername");e=g.documentElement.getAttribute("isusb");parserPropfindXML(g,c,!1);g_folder_array.sort(sortByName);g_file_array.sort(sortByName);for(g=
0;g<g_folder_array.length;g++)g_folder_array[g].type=="usbdisk"&&arraymove(g_folder_array,g,0);g=addPathSlash(c);g!="/"&&(g=g.substring(0,g.length-1),g=g.substring(0,g.lastIndexOf("/")),g==""&&(g="/"));c=="/"&&createHostList(a,g_folder_array);g_list_view.get()==1?createListView($("#main_right_container #fileview"),a,g,g_folder_array,g_file_array,onMouseDownListDIVHandler):createThumbView($("#main_right_container #fileview"),a,g,g_folder_array,g_file_array,onMouseDownThumbDIVHandler);g_thumb_loader.init($("#main_right_container #fileview"));
g_thumb_loader.start();showHideAiButton(e=="1"?!0:!1);closeAiMode();$("div#btnThumbView").css("display",g_list_view.get()==1?"block":"none");$("div#btnListView").css("display",g_list_view.get()==1?"none":"block");$("div#btnUpload").css("display",a==0&&g_select_mode==0?"block":"none");$("div#btnSelect").css("display",a==0&&g_select_mode==0?"block":"none");$("div#btnNewDir").css("display",a==0&&g_select_mode==0?"block":"none");$("div#btnPlayImage").css("display",a==0&&g_select_mode==0?"block":"none");
$("#btnCancelSelect").css("display",g_select_mode==1?"block":"none");$("#btnCancelUpload").css("display",g_upload_mode==1?"block":"none");$("#btnChangeUser").css("display",a==1&&e==0?"block":"none");$("span#username").text(d);g_storage.set("openurl",c);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));$("#main_right_container #hintbar").hide();adjustLayout();
closeJqmWindow(0);b!=void 0&&b()}}else a==501?doPROPFIND(c):a==401?setTimeout(function(){openLoginWindow(c)},2E3):alert(m.getString(a));showHideLoadStatus(!1)}},null,1),resetTimer()}catch(a){alert("catch error: "+a)}}}function registerPage(c){if(!(c!="/"||isPrivateIP(g_storage.get("wan_ip"))))c=g_storage.get("ddns_host_name"),c==""?alert("start ddns process"):window.location="http://140.130.25.39/aicloud?v=https://"+c}
function doLOGIN(c,b){doPROPFIND(c,function(){g_opening_uid!=""&&(g_storage.set("openhostuid",g_opening_uid),$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).addClass("select"):$(this).removeClass("select")}),g_opening_uid="")},b)}
function refreshHostList(){if(client!=null)try{client.PROPFIND("/",null,function(b,d,a){if(b&&b==207){var c,b=[];if(window.DOMParser)d=new DOMParser,c=d.parseFromString(a,"text/xml");else if(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a),!c.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var h,e,g,j,d=c.documentElement.childNodes,a=c.documentElement.getAttribute("qtype");c.documentElement.getAttribute("readonly");c.documentElement.getAttribute("ruser");
c.documentElement.getAttribute("computername");c.documentElement.getAttribute("isusb");for(c=0;c<d.length;c++){var k="",l="",p="",v="",w="",x="",q="",y="",z="",A="",B="",C="",D="",r,s=d[c].childNodes;for(h=0;h<s.length;h++)if(s[h].nodeType==1&&s[h].nodeName=="D:propstat"){var t=s[h].childNodes;for(e=0;e<t.length;e++)if(t[e].nodeName=="D:prop"){var o=t[e].childNodes;for(g=0;g<o.length;g++)if(!(o[g].childNodes.length<=0))if(o[g].nodeName=="D:getcontenttype")l=String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName==
"D:getuniqueid")p=String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName=="D:getonline")x=String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName=="D:getlastmodified")q=String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName=="D:getcontentlength")y=String(size_format(parseInt(o[g].childNodes[0].nodeValue)));else if(o[g].nodeName=="D:getmac")A=String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName=="D:getip")z=String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName=="D:gettype")B=
String(o[g].childNodes[0].nodeValue);else if(o[g].nodeName=="D:getattr"){var n=o[g].childNodes;for(j=0;j<n.length;j++)if(n[j].nodeName=="D:readonly")C=n[j].childNodes[0].nodeValue;else if(n[j].nodeName=="D:hidden")D=n[j].childNodes[0].nodeValue}}}else s[h].nodeType==1&&s[h].nodeName=="D:href"&&(k=String(s[h].childNodes[0].nodeValue),e="",k.match(/^http/)&&(e=window.location.protocol+"//"+window.location.host),g=e+addPathSlash("/"),k!=g?(k=k.replace(e,""),v=k.substring(k.lastIndexOf("/")+1,k.length),
v!=""?(r=v,w=v=mydecodeURI(v),e=g_list_view.get()==0?12:45,w.length>e&&(w=w.substring(0,e)+"...")):k=""):k="");k!=""&&l=="httpd/unix-directory"&&b.push({contenttype:l,href:k,name:v,uname:r,shortname:w,online:x,time:q,size:y,ip:z,mac:A,uid:p,type:B,freadonly:C,fhidden:D})}b.sort(sortByName);for(r=0;r<b.length;r++)b[r].type=="usbdisk"&&arraymove(b,r,0);createHostList(a,b)}},null,1)}catch(c){alert("catch error: "+c)}}
function sortByName(c,b){var d=c.name.toLowerCase(),a=b.name.toLowerCase();return d<a?-1:d>a?1:0}function arraymove(c,b,d){var a=c[b];c.splice(b,1);c.splice(d,0,a)}
function onMouseDownThumbDIVHandler(c){if(c.button==2||g_on_button_animation==1)return!1;if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"));else{$(this).find(".selectDiv").css("display")=="none"?($(this).find(".selectDiv").css("display","block"),$(this).find(".selectHintDiv").css("display","none")):($(this).find(".selectDiv").css("display","none"),$(this).find(".selectHintDiv").css("display","block"));g_select_array=
null;g_select_array=[];var b=0,d=0;$("#fileview").find(".albumDiv").each(function(){if($(this).find(".selectDiv").css("display")=="block"){var a=$(this).find("#list_item").attr("uhref"),c=$(this).find("#list_item").attr("isdir"),h=myencodeURI($(this).find("#list_item").attr("title"));c==1?d++:b++;g_select_array.push({isdir:c,uhref:a,title:h})}});b>0||d>0?(isAiModeView()<0&&$("#btnDeleteSel").removeClass("disable"),$("#btnDownload").removeClass("disable"),$("#btnShareLink").removeClass("disable")):
($("#btnDeleteSel").addClass("disable"),$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"));b+d==1&&isAiModeView()<0?$("#btnRename").removeClass("disable"):$("#btnRename").addClass("disable")}else openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function onMouseDownListDIVHandler(c){if(c.button==2||g_on_button_animation==1)return!1;if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this));else{$(this).find(".selectListDiv").css("display")=="none"?($(this).find(".selectListDiv").css("display","block"),$(this).find(".selectListHintDiv").css("display","none")):($(this).find(".selectListDiv").css("display","none"),$(this).find(".selectListHintDiv").css("display","block"));g_select_array=null;g_select_array=[];
var b=0,d=0;$("#fileview").find(".listDiv").each(function(){if($(this).find(".selectListDiv").css("display")=="block"){var a=$(this).attr("uhref"),c=$(this).attr("isdir"),h=myencodeURI($(this).attr("title"));c==1?d++:b++;g_select_array.push({isdir:c,uhref:a,title:h})}});b>0||d>0?(isAiModeView()<0&&$("#btnDeleteSel").removeClass("disable"),$("#btnDownload").removeClass("disable"),$("#btnShareLink").removeClass("disable")):($("#btnDeleteSel").addClass("disable"),$("#btnDownload").addClass("disable"),
$("#btnShareLink").addClass("disable"));b+d==1&&isAiModeView()<0?$("#btnRename").removeClass("disable"):$("#btnRename").addClass("disable")}else openSelItem($(this))}
function openSelItem(c){var b=c.attr("uhref")==void 0?"":c.attr("uhref"),d=c.attr("qtype")==void 0?0:c.attr("qtype"),a=c.attr("isdir")==void 0?0:c.attr("isdir"),f=c.attr("isusb")==void 0?0:c.attr("isusb"),h=c.attr("uhref")==void 0?"":c.attr("uhref"),e=c.attr("title")==void 0?"":c.attr("title");g_storage.set("opentype",f);if(b=="goto:music_album")client!=null&&(showHideLoadStatus(!0),b=g_storage.get("openurl")==void 0?"/":g_storage.get("openurl"),client.GETMUSICCLASSIFICATION(b,"album",function(a,
b,e){a==200?createClassificationView(e,"album"):a==503&&show_hint_no_mediaserver();showHideLoadStatus(!1)}));else if(b=="goto:music_artist")client!=null&&(showHideLoadStatus(!0),b=g_storage.get("openurl")==void 0?"/":g_storage.get("openurl"),client.GETMUSICCLASSIFICATION(b,"artist",function(a,b,e){a==200?createClassificationView(e,"artist"):a==503&&show_hint_no_mediaserver();showHideLoadStatus(!1)}));else if(d==2&&c.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(b=c.attr("mac"),client.WOL("/",
b,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else if(a=="1")doPROPFIND(b,null,null);else{d=getFileExt(b);a=g_storage.get("webdav_mode");if(d=="mp4"||d=="m4v"||d=="wmv"||d=="avi"||d=="rmvb"||d=="rm"||d=="mpg"||d=="mpeg"||d=="mkv"||d=="mov"||d=="flv")if((a==0||a==2)&&isWinOS())if(isBrowser("msie")&&getInternetExplorerVersion()<=7)alert(m.getString("msg_vlcsupport"));else{var g=$("div#modalWindow"),e=myencodeURI(e);this_url=h.substring(0,h.lastIndexOf("/"));
var j=window.location.host;j.indexOf(":")!=-1&&(j=j.substring(0,j.indexOf(":")));var j="http://"+j+":"+g_storage.get("http_port")+"/",k=c.attr("matadatatitle");client.GSL(this_url,this_url,e,0,0,function(a,b,e){a==200&&(a=parseXml(e),a=$(a).find("sharelink").text(),b="",b="/smb/css/vlc_video.html?v="+j+a,b+="&t="+k,b+="&showbutton=1",g_modal_url=b,g_modal_window_width=655,g_modal_window_height=580,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_videoplayer")),g&&g.jqmShow())});
return}if(d=="mp3")openAudioPlayer(b);else{if(d=="doc"||d=="docx"||d=="ppt"||d=="pptx"||d=="xls"||d=="xlsx"||d=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){e=myencodeURI(e);this_url=h.substring(0,h.lastIndexOf("/"));client.GSL(this_url,this_url,e,0,0,function(a,b,e){a==200&&(a=parseXml(e),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("https://docs.google.com/viewer?url="+a))});return}d=="jpg"||d=="jpeg"||d=="png"||d=="gif"?(c=getPageSize(),
g_image_player.show(b,c[0],c[1],g_file_array)):window.open(b)}}}
function addtoFavorite(){var c=g_storage.get("ddns_host_name"),b="https://"+c,d=isBrowser("msie");c==""&&(b="https://router.asus.com/");if(typeof window.sidebar=="object"&&typeof window.sidebar.addPanel=="function")return window.sidebar.addPanel("AiCloud",b,""),!1;else if(d&&typeof window.external=="object")return window.external.AddFavorite(b,"AiCloud"),!1;else{window.location=b;var c=navigator.userAgent.toLowerCase(),b="",d=c.indexOf("webkit")!=-1,a=c.indexOf("mac")!=-1;if(c.indexOf("konqueror")!=
-1)b="CTRL + B";else if(window.home||d||a)b=(a?"Command/Cmd":"CTRL")+" + D";b=b?m.getString("msg_add_favorite1")+b+m.getString("msg_add_favorite2"):b;alert(b)}}var IE=document.all?!0:!1;IE||document.captureEvents(Event.MOUSEMOVE);
function getMouseXY(c){IE?(g_mouse_x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g_mouse_y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop):(g_mouse_x=c.pageX,g_mouse_y=c.pageY);g_mouse_x<0&&(g_mouse_x=0);g_mouse_y<0&&(g_mouse_y=0);return!0}
$(document).ready(function(){function c(a){a&&a[0]!=2?alert(m.getString(a)+" : "+decodeURI(g_selected_files[0])):(g_selected_files.splice(0,1),g_selected_files.length<=0?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):client.DELETE(g_selected_files[0],c))}if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Mobile/i)){var b=window.location.href,b=b.substr(b.lastIndexOf("?")+1,b.length);if(b.indexOf("desktop=1")!=
0){b=window.location.href;b=b.substr(0,b.lastIndexOf("?"));window.location=b+"?mobile=1";return}}document.oncontextmenu=function(){return!1};document.onmousedown=function(){resetTimer()};document.onmousemove=function(a){getMouseXY(a);resetTimer()};$(document).keydown(function(a){if(a.keyCode==27){if(g_select_mode==1)cancelSelectMode();else if(g_upload_mode==1){if(confirmCancelUploadFile()==0)return;closeUploadPanel()}closeJqmWindow()}});g_storage.set("stopLogoutTimer","0");g_storage.set("isOpenModalWindow",
"0");g_storage.set("isOnUploadFile","0");createLayout();showHideLoadStatus(!1);adjustLayout();(function(){var a=g_storage.get("openurl");client.GETROUTERINFO(a==void 0?"/":a,function(a,b,e){a==200&&(a=parseXml(e),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("http_enable",a.find("http_enable").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),
g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("misc_https_port",String(a.find("misc_https_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),g_storage.set("router_version",a.find("version").text()),g_storage.set("aicloud_version",a.find("aicloud_version").text()),g_storage.set("wan_ip",a.find("wan_ip").text()),g_storage.set("modalname",
a.find("modalname").text()),g_storage.set("usbdiskname",a.find("usbdiskname").text()),g_storage.set("dms_enable",a.find("dms_enable").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})})();if(g_fileview_only==0){var d=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){d!=void 0&&d!="/"&&doPROPFIND(d);if(g_storage.get("openhostuid")==void 0||
g_storage.get("openhostuid")==0){var a="<div id='help_1'>";a+="<div id='help_content'>";a+=m.getString("msg_help");a+="</div>";a+="<div id='help_image'>";a+="</div>";a+="</div>";$("div#fileview").append(a)}},0)}else d=g_storage.get("openurl"),doPROPFIND(d);initAudioPlayer();$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){var b=$(a.w);a.o.remove();b.fadeOut("200",function(){g_show_modal=0;if(g_reload_page==1){var a=addPathSlash(g_storage.get("openurl"));doPROPFIND(a)}})},
onShow:function(a){var a=$(a.w),b=$("#jqmContent",a);$("#jqmTitle",a);var d=(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase().indexOf("msie");var e=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a};g_modal_url!=""&&(b.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(b),$("iframe",a).attr("src",g_modal_url));isBrowser("msie")&&
e()<=8&&(g_modal_window_height+=25);a.css({width:g_modal_window_width,height:g_modal_window_height,left:d,top:-g_modal_window_height,opacity:0,display:"block"}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:d,marginLeft:0,opacity:1},200,function(){adjustLayout();$(this).css("display","block")})}});$("div#btnDeleteSel").click(function(){if($(this).hasClass("disable"))return!1;if(!(g_select_array.length<=0)&&confirm(m.getString("del_files_msg"))==!0){g_selected_files=
null;g_selected_files=[];for(var a=0;a<g_select_array.length;a++)g_selected_files.push(g_select_array[a].uhref);client.DELETE(g_selected_files[0],c)}});$("div#btnNewDir").click(function(){if($(this).hasClass("disable"))return!1;var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnShareLink").click(function(){if($(this).hasClass("disable"))return!1;
closePopupmenu();var a="<div class='popupmenu' id='popupmenu'>";a+="<div class='menuitem' id='share2facebook'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";a+="<div style='-webkit-user-select: none;'>"+
m.getString("title_share2facebook")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="<div class='menuitem' id='sharebyemail'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";a+="<div style='-webkit-user-select: none;'>"+
m.getString("title_gen_sharelink")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="</div>";$(a).appendTo("body");$(".popupmenu").css("left",g_mouse_x-$(".popupmenu").width()+"px");$(".popupmenu").css("top",g_mouse_y-$(".popupmenu").height()+"px");$("#share2facebook").click(function(){closePopupmenu();var a=$("div#modalWindow");if(!(g_select_array.length<=0)){var b=g_storage.get("ddns_host_name"),e=g_storage.get("webdav_mode"),d=b==""?window.location.host:b;d.indexOf(":")!=-1&&(d=d.substring(0,
d.indexOf(":")));for(var b={_array:[],add:function(a){this._array.push(a)},length:function(){return this._array.length},get:function(a){return a<0||a>this._array.length-1?null:this._array[a]},remove:function(a){a>=0&&a<=this._array.length-1&&this._array.splice(a,1)},create:function(a){var b=this,e="",c="",f="http://"+d+":"+g_storage.get("http_port");if(this._array.length<=0)a&&a("");else{for(var h=0;h<this._array.length;h++){var j=this._array[h].title,e=this._array[h].uhref,e=e.substring(0,e.lastIndexOf("/"));
c+=j;c+=";"}client.GSL(e,e,c,0,0,function(e,d,c){d="";if(e==200){e=parseXml(c);e=$(e).find("sharelink").text().split(";");for(c=0;c<e.length;c++)d+=f+"/"+e[c],d+=","+b._array[c].isdir,c!=e.length-1&&(d+=";")}a&&a(d)})}}},c={_array:[],add:function(a){this._array.push(a)},length:function(){return this._array.length},get:function(a){return a<0||a>this._array.length-1?null:this._array[a]},remove:function(a){a>=0&&a<=this._array.length-1&&this._array.splice(a,1)},create:function(a){var b=this,c="",f="",
h="";if(this._array.length<=0)a&&a("");else{for(var h=e==0?"http://"+d+":"+g_storage.get("http_port"):"https://"+d,j=0;j<this._array.length;j++){var k=this._array[j].title,c=this._array[j].uhref,c=c.substring(0,c.lastIndexOf("/"));f+=k;f+=";"}client.GSL(c,c,f,86400,1,function(e,c,d){c="";if(e==200){e=parseXml(d);e=$(e).find("sharelink").text().split(";");for(d=0;d<e.length;d++)c+=h+"/"+e[d],c+=","+b._array[d].isdir,d!=e.length-1&&(c+=";")}a&&a(c)})}}},k=0;k<g_select_array.length;k++){var l=getFileExt(g_select_array[k].uhref);
l=="jpg"||l=="jpeg"||l=="png"||l=="gif"?b.add(g_select_array[k]):c.add(g_select_array[k])}var p="";b.create(function(b){p+=b;c.create(function(b){p!=""&&(p+=";");p+=b;b=window.location.href;b.indexOf("?")!=-1&&(b=b.substr(0,b.indexOf("?")));b.lastIndexOf("/")==-1&&(b+="/");b+="smb/css/proxyA.html";g_modal_url="http://develop.stage612.url.tw/facebook/upload.html";g_modal_url+="?v="+p;g_modal_url+="&d="+b;g_modal_url+="&l="+g_storage.get("lan");g_modal_window_width=600;g_modal_window_height=350;$("#jqmMsg").css("display",
"none");$("#jqmTitleText").text("Upload to Facebook");a&&a.jqmShow();$("#image_slide_show").remove()})})}});$("#sharebyemail").click(function(){closePopupmenu();if(!(g_select_array.length<=0)){m.getString("email_subject");for(var a="",b="",e="",c=0;c<g_select_array.length;c++){var d=g_select_array[c].title,b=g_select_array[c].uhref,k=window.location.href,b=k=b.substring(0,b.lastIndexOf("/"));e+=d;e+=";"}var c=g_storage.get("webdav_mode"),d=g_storage.get("ddns_host_name"),l=d==""?window.location.host:
d;l.indexOf(":")!=-1&&(l=l.substring(0,l.indexOf(":")));var p=isPrivateIP(l),l=c==0?"http://"+l+":"+g_storage.get("http_port"):"https://"+l;client.GSL(b,b,e,86400,1,function(b,e,c){if(b==200)if(b=parseXml(c),b=$(b).find("sharelink").text(),b=="")alert("Fail to parse xml!");else{b=b.split(";");e=b.length;for(c=0;c<e;c++)a+=l+"/"+b[c],c!=e-1&&(a+="<br><br>");b=$("div#modalWindow");g_modal_url="/smb/css/sharelink.html?v="+a+"&b="+p;g_modal_window_width=600;g_modal_window_height=530;$("#jqmMsg").css("display",
"none");$("#jqmTitleText").text(m.getString("title_sharelink"));b&&b.jqmShow()}})}});return!1});$("div#btnDownload").click(function(){if($(this).hasClass("disable"))return!1;if(!(g_select_array.length<=0)){for(var a=[],b=0;b<g_select_array.length;b++){var c=g_select_array[b].title,e=g_select_array[b].uhref,d=g_select_array[b].isdir,j=window.location.href,j=e.substring(0,e.lastIndexOf("/")),c=j+"/"+c;d==1?a.push(c):$.fileDownload(c,{successCallback:function(){},failCallback:function(a,b){window.open(b)}})}c=
a.length;if(c>0){d="";for(b=0;b<c;b++)d+=a[b],b!=c-1&&(d+=";");a=$("div#modalWindow");g_modal_url="/smb/css/download_folder.html?v="+d+"&u="+g_storage.get("openurl");g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_download_folder"));a&&a.jqmShow()}}});$("div#btnRename").click(function(){if($(this).hasClass("disable"))return!1;if(g_select_array.length==1){var a=g_select_array[0].title,b=g_select_array[0].uhref,c=g_select_array[0].isdir,
e=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+b+"&d="+c;g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));e&&e.jqmShow()}});$("div#btnLock").click(function(){if($(this).hasClass("disable"))return!1;g_select_array.length==1&&client.LOCK(g_select_array[0].uhref,"",function(a,b,c){a!="201"?alert("Error unlocking: "+b):(g_current_locktoken=getLockToken(c),alert("locktoken: "+g_current_locktoken))},
null,"exclusive","write",0,3)});$("div#btnUnLock").click(function(){if($(this).hasClass("disable"))return!1;g_select_array.length==1&&client.UNLOCK(g_select_array[0].uhref,g_current_locktoken,function(a){alert(a)})});$("div#btnChangeUser").click(function(){if(confirm(m.getString("msg_changeuser_confirm"))==!0){$("#main_right_container #fileview").empty();var a=g_storage.get("openurl");client.LOGOUT(a,function(b){b==200&&doPROPFIND(a)})}});$("div#btnSelect").click(function(){g_select_mode=1;var a=
$("div#btnSelect").position();g_btnSelect_right_position=$("#main_right_container #infobar").width()-(a.left+$("div#btnSelect").outerWidth());$("div#boxSearch").css("display","none");$("div#btnSelect").css("display","none");$("div#btnNewDir").css("display","none");$("div#btnPlayImage").css("display","none");$("div#btnUpload").css("display","none");$("div#btnThumbView").css("display","none");$("div#btnListView").css("display","none");$("div#btnCancelSelect").css("display","block");$("div#btnCancelSelect").css("right",
g_btnSelect_right_position);showHideEditUIRegion(!0);g_on_button_animation=1;$("div#btnCancelSelect").animate({right:0},500,function(){$(".selectHintDiv").css("display","block");$(".selectListHintDiv").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();g_on_button_animation=0})});$("div#btnCancelSelect").click(function(){$("div#btnCancelSelect").css("display","none");$("div#btnSelect").css("display","block");$("div#btnSelect").css("right",
0);showHideEditUIRegion(!1);g_on_button_animation=1;$("div#btnSelect").animate({right:g_btnSelect_right_position},500,function(){cancelSelectMode();$("div#btnSelect").css("right",0);g_on_button_animation=0})});$("#btnThumbView").click(function(){if(confirmCancelUploadFile()!=0){g_list_view.set(0);$("#btnThumbView").css("display","none");$("#btnListView").css("display","block");var a=g_storage.get("openurl"),a=a==void 0?"/":a,b=isAiModeView();if(b<0)doPROPFIND(a);else{var c=g_storage.get("data-id")==
void 0?"":g_storage.get("data-id"),e=myencodeURI($("div#boxSearch input").val());doPROPFINDMEDIALIST(a,!1,null,b,"0","50",e,"TIMESTAMP","DESC",c)}}});$("#btnListView").click(function(){g_list_view.set(1);$("#btnThumbView").css("display","block");$("#btnListView").css("display","none");var a=g_storage.get("openurl"),a=a==void 0?"/":a,b=isAiModeView();if(b<0)doPROPFIND(a);else{var c=g_storage.get("data-id")==void 0?"":g_storage.get("data-id"),e=myencodeURI($("div#boxSearch input").val());doPROPFINDMEDIALIST(a,
!1,null,b,"0","50",e,"TIMESTAMP","DESC",c)}});$("#btnUpload").click(function(){if($(this).hasClass("disable"))return!1;closePopupmenu();var a="<div class='popupmenu' id='popupmenu'>";a+="<div class='menuitem' id='uploadfile'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";
a+="<div style='-webkit-user-select: none;'>"+m.getString("title_upload_file")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="<div class='menuitem' id='uploadfolder'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";
a+="<div style='-webkit-user-select: none;'>"+m.getString("title_upload_folder")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="</div>";$(a).appendTo("body");$(".popupmenu").css("left",g_mouse_x-$(".popupmenu").width()+"px");$(".popupmenu").css("top",g_mouse_y+"px");$("#uploadfile").click(function(){if(isBrowser("msie")&&getInternetExplorerVersion()<=9){var a=$("div#modalWindow");g_modal_url="/smb/css/upload_file.html";g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display",
"none");$("#jqmTitleText").text(m.getString("title_upload_file"));a&&a.jqmShow()}else g_upload_mode=1,$("div#btnNewDir").css("display","none"),$("div#btnUpload").css("display","none"),$("div#btnSelect").css("display","none"),$("div#btnPlayImage").css("display","none"),$("div#boxSearch").css("display","none"),$("div#btnListView").css("display","none"),$("div#btnThumbView").css("display","none"),$("#upload_panel").css("display","block"),$("#upload_panel").css("left","1999px"),$("#upload_panel").animate({left:"0px"},
"slow"),a=addPathSlash(g_storage.get("openurl")),$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a+"&d=1"),$("#function_help").text(m.getString("msg_uploadmode_help")),adjustLayout();closePopupmenu()});$("#uploadfolder").click(function(){if(isBrowser("chrome")){g_upload_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnPlayImage").css("display","none");$("div#boxSearch").css("display","none");
$("div#btnListView").css("display","none");$("div#btnThumbView").css("display","none");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a+"&d=2");$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout();closePopupmenu()}else a=$("div#modalWindow"),g_modal_url="/smb/css/upload_folder.html",g_modal_window_width=
600,g_modal_window_height=150,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_upload_folder")),a&&a.jqmShow()});return!1});$("#btnUpload2").click(function(){g_upload_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnPlayImage").css("display","none");$("div#boxSearch").css("display","none");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},
"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a);$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout()});$("#btnCancelUpload").click(closeUploadPanel);$(".mediaListDiv").mousedown(function(){if(confirmCancelUploadFile()!=0){var a=$(this).attr("qtype"),b=g_storage.get("openurl");g_storage.set("data-id","");$(".mediaListDiv").removeClass("down");$(this).addClass("down");g_ui_mode.set(a);doPROPFINDMEDIALIST(b,
!1,function(){},a,"0","50",null,"TIMESTAMP","DESC")}});$("div#btnAiMusicPopupMenu").click(function(){closePopupmenu();var a="<div class='popupmenu' id='popupmenu'>";a+="<div class='menuitem' id='classifyByAlbum'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";
a+="<div style='-webkit-user-select: none;'>"+m.getString("title_sort_by_album")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="<div class='menuitem' id='classifyByArtist'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";
a+="<div style='-webkit-user-select: none;'>"+m.getString("title_sort_by_artist")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="</div>";$(a).appendTo("body");$(".popupmenu").css("left",g_mouse_x-$(".popupmenu").width()+"px");$(".popupmenu").css("top",g_mouse_y-$(".popupmenu").height()+"px");$("#classifyByAlbum").click(function(a){if(client!=null){closePopupmenu();showHideLoadStatus(!0);var b=g_storage.get("openurl");client.GETMUSICCLASSIFICATION(b==void 0?"/":b,"album",function(a,
b,c){a==200?createClassificationView(c,"album"):a==503&&show_hint_no_mediaserver();showHideLoadStatus(!1)});a.preventDefault();return!1}});$("#classifyByArtist").click(function(){if(client!=null){closePopupmenu();showHideLoadStatus(!0);var a=g_storage.get("openurl");client.GETMUSICCLASSIFICATION(a==void 0?"/":a,"artist",function(a,b,c){a==200?createClassificationView(c,"artist"):a==503&&show_hint_no_mediaserver();showHideLoadStatus(!1)})}})});$("div#hostview").scroll(function(){g_storage.set("hostviewscrollTop",
$(this).scrollTop())});$("div#fileview").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$(".navigation#lan dd a").click(function(){if(confirmCancelUploadFile()!=0){var a=$(this).attr("id");g_storage.set("lan",a);window.location.reload()}});$(".navigation#setting dd a").click(function(){var a=$(this).attr("id");if(a=="logout")confirmCancelUploadFile()!=0&&(a=confirm(m.getString("msg_logout_confirm")),a==!0&&doLOGOUT());
else if(a=="mobile"){var b=window.location.href,b=b.substr(0,b.lastIndexOf("?"));window.location=b+"?mobile=1"}else if(a=="favorite")addtoFavorite();else if(a=="config"){var b=g_storage.get("http_enable"),c=g_storage.get("misc_http_enable"),e=g_storage.get("misc_http_port"),d=g_storage.get("misc_https_port"),j=window.location.host,k="http",a=e;c==0&&!isPrivateIP()?alert(m.getString("msg_no_config")):(b=="0"?(k="http",a=e):b=="1"&&(k="https",a=d),isPrivateIP()?b=k+"://"+j.split(":")[0]:(b=k+"://"+
j.split(":")[0],a!=""&&(b+=":"+a)),window.location=b)}else a=="help"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_window_height=b[1]-30,g_modal_window_width=g_modal_window_height*1.28,g_modal_window_width>b[0]&&(g_modal_window_width=b[0],g_modal_window_height=g_modal_window_width*0.78125),g_modal_url="/smb/css/help.html?showbutton=1",$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_help")),a&&a.jqmShow()):a=="rescan_samba"?confirmCancelUploadFile()!=0&&(a=confirm(m.getString("title_desc_rescan")),
a==!0&&doRescanSamba()):a=="sharelink"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=1&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="version"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=2&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),
a&&a.jqmShow()):a=="other_settings"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=3&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="test"&&client.GETROUTERINFO("/AICLOUD306106790/AiCloud",function(a,b,e){a==200&&(a=parseXml(e),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",
a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),g_storage.set("router_version",a.find("version").text()),g_storage.set("wan_ip",a.find("wan_ip").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+
a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})});$(".navigation#refresh dt a").click(function(){if(confirmCancelUploadFile()!=0){var a=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){a=a==void 0?"/":a;a!="/"&&doPROPFIND(a)},0)}});$(".themes_ctrl").click(function(){if(confirmCancelUploadFile()!=0){var a=$(this).attr("id");g_storage.setl("skin",a);window.location.reload()}});$("div#btnPlayImage").click(function(){var a=getPageSize();g_image_player.show("",
a[0],a[1],g_file_array)});$("div#boxSearch").keyup(function(){var a=myencodeURI($("div#boxSearch input").val()),b=$(this).attr("uhref"),c=$(this).attr("qtype"),e=g_storage.get("data-id")==void 0?"":g_storage.get("data-id");doPROPFINDMEDIALIST(b,!1,function(){},c,"0","50",a,"TIMESTAMP","DESC",e)});$("div#logo").click(function(){g_fileview_only!=1&&doPROPFIND("/",function(){g_storage.set("openhostuid","");window.location.reload()},0)});$(window).resize(adjustLayout)});
window.onbeforeunload=function(c){if(g_storage.get("isOnUploadFile")==1){var b=m.getString("msg_confirm_cancel_upload");if(c=c||window.event)c.returnValue=b;return b}};window.onunload=function(){g_storage.get("isOnUploadFile")==1&&$("#upload_panel iframe")[0].contentWindow.stop_upload()};function doBackgroundPlay(){alert("doBackgroundPlay")};var g_bshowHideAiButton=!0,g_bshowHideEditUIRegion=!1,g_hide_aidisk_name=1,g_list_view={_storage:new myStorage,set:function(c){this._storage.setl("listview",c)},get:function(){return this._storage.getl("listview")}},g_ui_mode={_storage:new myStorage,set:function(c){this._storage.set("uimode",c)},get:function(){return this._storage.get("uimode")}},g_usbdisk_space_handler={_changed:!1,_usbdisk_query_index:0,_usbdisk_current_query_index:-1,_usbdisk_query_timer:0,_array:[],add:function(c,b){if(!this.exist(c,
b)){var d={};d.id=c;d.name=b;d.done=!1;d.diskUsedPercent="0%";d.diskUsed=0;d.diskAvailable=0;this._array.push(d)}},exist:function(c,b){for(var d=0;d<this.len();d++)if(this.item(d).id==c&&this.item(d).name==b)return!0;return!1},len:function(){return this._array.length},item:function(c){return c<0||c>this._array.length-1?null:this._array[c]},refresh:function(){if(!(this.len()<=0)){var c=function(b){if(b!=null){var a="div."+b.id+" .progress-bar span";$("div."+b.id+" p").text(b.name+" "+bytesToSize(b.diskUsed)+
" / "+bytesToSize(b.diskAvailable+b.diskUsed));$(a).css("width",b.diskUsedPercent)}},b=this;this._usbdisk_query_index=0;this._usbdisk_current_query_index=-1;this._usbdisk_query_timer=setInterval(function(){if(b._usbdisk_current_query_index!=b._usbdisk_query_index){var d=b.len(),a=b.item(b._usbdisk_query_index);if(a!=null){var f=a.name,h=a.done;b._usbdisk_current_query_index=b._usbdisk_query_index;h?(c(a),b._usbdisk_query_index==d-1?clearInterval(b._usbdisk_query_timer):b._usbdisk_query_index++):(h=
new davlib.DavClient,h.initialize(),h.GETDISKSPACE("/",f,function(e,f,h){if(e==200)e=parseXml(h),e=$(e),a.diskUsedPercent=e.find("DiskUsedPercent").text()==""?"0%":e.find("DiskUsedPercent").text(),a.diskUsed=parseInt(e.find("DiskUsed").text()==""?"0":e.find("DiskUsed").text())*1024,a.diskAvailable=parseInt(e.find("DiskAvailable").text()==""?"0":e.find("DiskAvailable").text())*1024,a.done=!0,c(a),b._usbdisk_query_index==d-1?clearInterval(b._usbdisk_query_timer):b._usbdisk_query_index++}),h=null)}}},
200)}}};function bytesToSize(c){if(c==0)return"0";var b=parseInt(Math.floor(Math.log(c)/Math.log(1024)));return Math.round(c/Math.pow(1024,b),2)+" "+["Bytes","KB","MB","GB","TB"][b]}
function createLayout(){var c=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),c=g_storage.get("lan")==void 0?c:g_storage.get("lan"),c=m.setLanguage(c);g_storage.set("lan",c);$("body").attr("openurl")!=void 0&&g_storage.set("openurl",$("body").attr("openurl"));$("body").attr("fileview_only")!=void 0&&(g_fileview_only=$("body").attr("fileview_only"));var b="";b+="<div id='header_region' class='unselectable' width='100%' border='0'>";g_fileview_only==0&&(b+="<div id='user'><div id='user_image' class='sicon'></div><span id='username'></span><span id='login_info'></span>",
b+="</div>");b+="<div id='loading'><img src='/smb/css/load.gif'/><div><span>Loading...</span></div></div>";b+="<ul class='navigation' id='lan'>";b+="<li>";b+="<dl>";b+="<dt><a id='"+c+"'>"+m.getString("lan_"+c)+"</a></dt>";for(var d=0;d<g_support_lan.length;d++)g_support_lan[d]!=c&&(b+="<dd><a id='"+g_support_lan[d]+"'>"+m.getString("lan_"+g_support_lan[d])+"</a></dt>");b+="</dl>";b+="</li>";b+="<ul>";b+="</div>";b+="<div id='main_region' class='unselectable'>";b+="<div style='width: 100%;height:100%;float:left;position: relative;'>";
g_fileview_only==0&&(b+="<div id='main_left_region' class='unselectable'>",b+="<div id='infobar' class='unselectable'>",b+="<div id='logo'></div>",b+="<div style='text-align:center;'><img class='production_icon' style='width:auto !important;height:145px;'></div>",b+="</div>",b+="<div id='hostview' class='unselectable'></div>",b+="</div>");b+="<div id='main_right_region' class='unselectable'>";b+="<div id='main_right_container' class='unselectable'>";b+="<div id='infobar' class='unselectable'>";b+=
"<div id='toolbar' class='unselectable'>";b+="<div id='urlregion-url'>";b+="<p id='openurl' align='left' width='150' style='padding-left:10px' ></p>";b+="</div>";b+="<div class='albutton toolbar-button-right' id='btnThumbView' style='display:none'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-right' id='btnListView' style='display:none'><div class='ticon'></div></div>";g_fileview_only==0&&(b+="<div class='albutton toolbar-button-right' id='btnUpload' style='display:none'><div class='ticon'></div></div>",
b+="<div class='albutton toolbar-button-right' id='btnPlayImage' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnNewDir' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnSelect' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnCancelSelect' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnCancelUpload' style='display:none'><div class='ticon'></div></div>",
b+="<div class='albutton toolbar-button-right' id='btnChangeUser' style='display:none'><div class='ticon'></div></div>",b+="<div class='alsearch toolbar-button-right' id='boxSearch' style='display:none'><input type='text'/></div>");b+="</div>";b+="</div>";b+="<div id='hintbar' class='unselectable'></div>";b+="<div id='fileview' class='unselectable'></div>";b+="<div id='upload_panel' class='unselectable'>";b+="<div style='position:absolute;width:98%;height:100%;padding:10px'>";b+="<iframe src='' width='100%' height='100%' frameborder='0'/>";
b+="</div>";b+="</div>";b+="</div>";b+="</div>";g_fileview_only==0&&(b+="<div id='button_panel' class='unselectable'>",b+="<div id='ui_region'>",b+="<div class='abbutton toolbar-button-left mediaListDiv' id='btnAiMusic' style='display:none' qtype='2'>",b+="<div class='ticon'><span>"+m.getString("title_audiolist")+"</span></div></div>",b+="<div class='abbutton toolbar-button-left' id='btnAiMusicPopupMenu' style='display:none' qtype='2'>",b+="<div class='picon'></div></div>",b+="<div class='abbutton toolbar-button-left mediaListDiv' id='btnAiMovie' style='display:none' qtype='3'>",
b+="<div class='ticon'><span>"+m.getString("title_videolist")+"</span></div></div>",b+="<div class='abbutton toolbar-button-left mediaListDiv' id='btnAiPhoto' style='display:none' qtype='1'>",b+="<div class='ticon'><span>"+m.getString("title_imagelist")+"</span></div></div>",b+="<div id='edit_ui_region' style='display:none'>",b+="<div class='albutton toolbar-button-right disable' id='btnShareLink' style='display:block'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right disable' id='btnDeleteSel' style='display:block'><div class='ticon'></div></div>",
b+="<div class='albutton toolbar-button-right disable' id='btnDownload' style='display:block'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right disable' id='btnRename' style='display:block'><div class='ticon'></div></div>",b+="</div>",b+="</div>",b+="</div>");b+="</div>";b+="</div>";b+="<div id='bottom_region' class='unselectable'>";g_fileview_only==0&&(b+="<ul class='navigation' id='setting'>",b+="<li>",b+="<dl>",b+="<dd><a id='web_help' href='http://event.asus.com/2012/nw/aicloud/faq.html' target='_blank'>"+
m.getString("title_help")+"</a></dt>",b+="<dd><a id='web_feedback' href='https://vip.asus.com/VIP2/Services/QuestionForm/TechQuery' target='_blank'>"+m.getString("title_feedback")+"</a></dt>",b+="<dd><a id='version'>"+m.getString("title_version")+"</a></dt>",b+="<dd><a id='sharelink'>"+m.getString("title_sharelink")+"</a></dt>",b+="<dd><a id='rescan_samba'>"+m.getString("title_rescan")+"</a></dt>",b+="<dd><a id='config'>"+m.getString("btn_config")+"</a></dt>",b+="<dd><a id='favorite'>"+m.getString("btn_favorite")+
"</a></dt>",b+="<dd><a id='mobile'>"+m.getString("title_mobile_view")+"</a></dt>",b+="<dd><a id='logout'>"+m.getString("title_logout")+"</a></dt>",b+="<dt><a>"+m.getString("title_setting")+"</a></dt>",b+="</dl>",b+="</li>",b+="</ul>",b+="<ul class='navigation' id='refresh'>",b+="<li>",b+="<dl>",b+="<dt><a>"+m.getString("btn_refresh")+"</a></dt>",b+="</dl>",b+="</li>",b+="</ul>");b+="<ul class='func_help'>";b+="<span id='function_help'></span>";b+="</ul>";b+="<span id='right_info'>ASUSTeK Computer Inc. All rights reserved</span>";
b+="</div>";b+="<div id='modalWindow' class='jqmWindow'>";b+="<div id='jqmTitle'>";b+="<span id='jqmTitleText'></span>";b+="</div>";b+="<div id='jqmMsg'>";b+="<span id='jqmMsgText'></span>";b+="</div>";b+="<div id='jqmContent' style='padding;0px;margin:0px'>";b+="</div>";b+="</div>";b+=getAudioPlayerLayout();$("body").empty();$("body").append(b);client.GETPRODUCTICON("/",function(a,b,c){a==200&&(a=parseXml(c),a=$(a),$("img.production_icon").attr("src","data:"+a.find("mimetype").text()+";base64,"+
a.find("product_icon").text()))});$("#main_region").mousedown(function(){closePopupmenu()});$("span#username").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});$(".navigation li, .navigation li a").mouseenter(function(){$(this).find("dd").fadeIn("fast")});$(".navigation li, .navigation li a").mouseleave(function(){$(this).find("dd").fadeOut("fast")});$("#mainCss").attr("href","/smb/css/style-theme.css");$("#btnHelp").attr("title",m.getString("title_help"));$("#btnLogout").attr("title",
m.getString("title_logout"));$("#btnConfig").attr("title",m.getString("btn_config"));$("#btnUpload").attr("title",m.getString("btn_upload"));$("#btnCancelUpload").attr("title",m.getString("btn_cancelupload"));$("#btnSelect").attr("title",m.getString("btn_select"));$("#btnCancelSelect").attr("title",m.getString("btn_cancelselect"));$("#btnNewDir").attr("title",m.getString("btn_newdir"));$("#btnShareLink").attr("title",m.getString("btn_sharelink"));$("#btnDeleteSel").attr("title",m.getString("btn_delselect"));
$("#btnDownload").attr("title",m.getString("func_download"));$("#btnRename").attr("title",m.getString("btn_rename"));$("#btnSetting").attr("title",m.getString("title_setting"));$("#btnRefresh").attr("title",m.getString("btn_refresh"))}
function createHostList(c,b){var d="";$("#hostview").empty();var a=g_storage.get("HostList")?g_storage.get("HostList").split(/,/):[],f=g_storage.getl("onRescanSamba"),h=g_storage.getl("onRescanSambaCount"),e=g_storage.getl("rescan_samba_timer");if(c==2)for(var g=0;g<b.length;g++){var j=b[g].href+"|"+b[g].name+"|"+b[g].online+"|"+b[g].ip+"|"+b[g].mac+"|"+b[g].uid+"|"+b[g].freadonly+"|"+b[g].fhidden+"|"+b[g].type;a.contains(j)||a.push(j);g_storage.set("HostList",a.join(","))}for(g=0;g<a.length;g++){j=
a[g].split("|");d+="<div class='host_item unselectable";j[2]==0&&(d+=" offline");j[8]=="usbdisk"&&(d+=" usbdisk");d+="' uhref='";d+=j[0];d+="' title='";d+=j[1]+" - "+j[3];d+="' online='";d+=j[2];d+="' isdir='1'";d+=" ip='";d+=j[3];d+="' mac='";d+=j[4];d+="' uid='";d+=j[5];d+="' freadonly='";d+=j[6];d+="' fhidden='";d+=j[7];d+=j[8]=="usbdisk"?"' isusb='1'":"' isusb='0'";d+=">";d+="<div id='hosticon' class='sicon "+j[8];j[2]==0&&(d+="off");d+="'/>";if(j[8]=="usbdisk"){var k="usbdisk"+(g+10);d+="<div id='hostinfo' class='unselectable "+
k+"'>";g_usbdisk_space_handler.add(k,j[1])}else d+="<div id='hostinfo' class='unselectable'>";d+="<div id='hostname' class='unselectable'>";d+="<p>";d+=j[1];j[2]==0&&(d+="("+m.getString("title_offline")+")");d+="</p>";d+="</div>";j[8]=="usbdisk"&&(d+="<div id='space'>",d+="<div class='progress-bar'>",d+="<span></span>",d+="</div>",d+="</div>");d+="</div>";d+="</div>"}g_usbdisk_space_handler.refresh();f==1&&(d+="<div class='scan_item unselectable rescan'>",d+="<div id='hosticon' class='sicon sambapcrescan'/>",
d+="<div id='scanlabel' class='unselectable'>",d+="<p>"+m.getString("title_scan")+"</p>",d+="</div>",d+="</div>",e==0&&(e=setInterval(function(){h++;h>=10?(clearInterval(e),g_storage.setl("rescan_samba_timer",0),g_storage.setl("onRescanSamba",0),g_storage.setl("onRescanSambaCount",0)):g_storage.setl("onRescanSambaCount",h);refreshHostList()},5E3),g_storage.setl("rescan_samba_timer",e)));$("#hostview").append(d);var l=g_storage.get("openhostuid");$("#hostview .host_item").each(function(){$(this).attr("uid")==
l?$(this).addClass("select"):$(this).removeClass("select")});$("#hostview .host_item").click(function(){if(confirmCancelUploadFile()!=0)if($(this).attr("online")==0)confirm(m.getString("wol_msg"))==!0&&client.WOL("/",$(this).attr("mac"),function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))});else{g_opening_uid=$(this).attr("uid");var a=$(this).attr("uhref");g_storage.set("opentype",$(this).attr("type")=="usbdisk"?"1":"0");doPROPFIND(a,function(){g_storage.set("openhostuid",
g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).addClass("select"):$(this).removeClass("select")});g_opening_uid=""},null)}})}
function createListView(c,b,d,a,f,h){var e="";c.empty();if(b!=2){e+='<table id="ntl" class="table-file-list">';e+="<thead>";e+="<tr>";e+='<th style="width:3%"></th>';e+='<th style="width:4%"></th>';e+='<th style="width:58%">'+m.getString("table_filename")+"</th>";e+='<th style="width:25%">'+m.getString("table_time")+"</th>";e+='<th style="width:10%">'+m.getString("table_size")+"</th>";e+="</tr>";e+="</thead>";e+="<tbody>";b==0&&(e+='<tr class="listDiv cb cbp" ',e+='qtype="1" isParent="1" isdir="1" uhref="',
e+=d,e+='" title="'+m.getString("btn_prevpage")+'" online="0">',e+='<td field="check"></td>',e+='<td field="icon"><div id="fileviewicon" class="parentDiv sicon"></td>',e+='<td field="filename" align="left">'+m.getString("btn_prevpage")+"</td>",e+='<td field="time" align="left"></td>',e+='<td field="size" align="left"></td>',e+="</tr>");for(d=0;d<a.length;d++)e+='<tr class="listDiv cb"',e+=' id="list_item" qtype="',e+=b,e+='" isdir="1" uhref="',e+=a[d].href,e+='" title="',e+=a[d].name,e+='" online="',
e+=a[d].online,e+='" ip="" mac="',e+=a[d].mac,e+='" uid="',e+=a[d].uid,e+='" freadonly="',e+=a[d].freadonly,e+='" fhidden="',e+=a[d].fhidden,e+='" data-thumb="',e+=a[d].thumb,e+='" data-name="',e+=a[d].name,e+=a[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"',e+='">',e+='<td field="check">',e+='<div class="checklist">',e+='<div class="selectListDiv sicon"></div>',e+='<div class="selectListHintDiv sicon"></div>',e+="</div>",e+="</td>",e+='<td field="icon">',e+=b=="2"?a[d].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv sicon">':
a[d].online=="1"?'<div id="fileviewicon" class="computerDiv sicon">':'<div id="fileviewicon" class="computerOffDiv sicon">':'<div id="fileviewicon" class="folderDiv sicon">',e+="</td>",e+='<td field="filename" align="left">'+a[d].name+"</td>",e+='<td field="time" align="left">'+a[d].time+"</td>",e+='<td field="size" align="left"></td>',e+="</tr>";for(d=0;d<f.length;d++)b=getFileExt(String(f[d].href)),b.length>5&&(b=""),e+='<tr class="listDiv cb"',e+=' id="list_item" qtype="1" isdir="0" uhref="',e+=
f[d].href,e+='" title="',e+=f[d].name,e+='" matadatatitle="',e+=f[d].matadatatitle,e+='" uid="',e+=f[d].uid,e+='" ext="',e+=b,e+='" freadonly="',e+=f[d].freadonly,e+='" fhidden="',e+=f[d].fhidden,e+='" data-thumb="',e+=f[d].thumb,e+='" data-name="',e+=f[d].name,e+='">',e+='<td field="check">',e+='<div class="checklist">',e+='<div class="selectListDiv sicon"></div>',e+='<div class="selectListHintDiv sicon"></div>',e+="</div>",e+="</td>",e+='<td field="icon">',e+=b=="jpg"||b=="jpeg"||b=="png"||b=="gif"||
b=="bmp"?'<div id="fileviewicon" class="imgfileDiv sicon">':b=="mp3"||b=="m4a"||b=="m4r"||b=="wav"?'<div id="fileviewicon" class="audiofileDiv sicon">':b=="mp4"||b=="rmvb"||b=="m4v"||b=="wmv"||b=="avi"||b=="mpg"||b=="mpeg"||b=="mkv"||b=="mov"||b=="flv"||b=="3gp"||b=="m2v"||b=="rm"?'<div id="fileviewicon" class="videofileDiv sicon">':b=="doc"||b=="docx"?'<div id="fileviewicon" class="docfileDiv sicon">':b=="ppt"||b=="pptx"?'<div id="fileviewicon" class="pptfileDiv sicon">':b=="xls"||b=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv sicon">':
b=="pdf"?'<div id="fileviewicon" class="pdffileDiv sicon">':'<div id="fileviewicon" class="fileDiv sicon">',e+="</td>",e+='<td field="filename" align="left">'+f[d].name+"</td>",e+='<td field="time" align="left">'+f[d].time+"</td>",e+='<td field="size" align="left">'+f[d].size+"</td>",e+="</tr>";e+="</tbody>";e+="</table>";e+='<table id="header-fixed" class="table-file-list"></table>';c.append(e);$(".cb").mousedown(h);var g=$("#ntl").offset().top,c=$("#ntl > thead").clone(),j=$("#header-fixed").append(c);
$("#header-fixed").css("width",$("#ntl").width());$("#fileview").bind("scroll",function(){var a=$(this).scrollTop();a>=g&&j.is(":hidden")?j.show():a<g&&j.hide()})}}
function createThumbView(c,b,d,a,f,h){var e="";c.empty();if(b!=2){b==0&&(e+='<div class="albumDiv">',e+='<table class="thumb-table-parent">',e+="<tbody>",e+="<tr><td>",e+='<div class="picDiv cb" isParent="1" popupmenu="0" uhref="',e+=d,e+='">',e+='<div class="parentDiv bicon"></div></div>',e+="</td></tr>",e+="<tr><td>",e+='<div class="albuminfo">',e+='<a id="list_item" qtype="1" isdir="1" uhref="',e+=d,e+='" title="'+m.getString("btn_prevpage")+'" online="0">'+m.getString("btn_prevpage"),e+="</a>",
e+="</div>",e+="</td></tr>",e+="</tbody>",e+="</table>",e+="</div>");for(d=0;d<a.length;d++){var g=m.getString("table_filename")+": "+a[d].name;a[d].time!=""&&(g+="\n"+m.getString("table_time")+": "+a[d].time);e+='<div class="albumDiv" ';e+=' title="';e+=g;e+='">';e+='<table class="thumb-table-parent">';e+="<tbody>";e+="<tr><td>";e+='<div class="picDiv cb" popupmenu="';e+=b=="0"?"1":"0";e+='" uhref="';e+=a[d].href;e+='" data-thumb="';e+=a[d].thumb;e+='" data-name="';e+=a[d].name;e+='">';e+=b=="2"?
a[d].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv bicon">':a[d].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">';a[d].routersyncfolder=="1"&&(e+='<div id="routersyncicon" class="routersyncDiv sicon"></div>');e+='<div class="selectDiv sicon"></div>';e+='<div class="selectHintDiv sicon"></div>';e+="</div></div>";e+="</td></tr>";e+="<tr><td>";e+='<div class="albuminfo">';e+=
'<a id="list_item" qtype="';e+=b;e+='" isdir="1" uhref="';e+=a[d].href;e+='" title="';e+=a[d].name;e+='" online="';e+=a[d].online;e+='" ip="" mac="';e+=a[d].mac;e+='" uid="';e+=a[d].uid;e+='" freadonly="';e+=a[d].freadonly;e+='" fhidden="';e+=a[d].fhidden;e+=a[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"';e+='">';e+=a[d].shortname;a[d].online=="0"&&b=="2"&&(e+="("+m.getString("title_offline")+")");e+="</a>";e+="</div>";e+="</td></tr>";e+="</tbody>";e+="</table>";e+="</div>"}for(d=0;d<f.length;d++)g=
m.getString("table_filename")+": "+f[d].name+"\n"+m.getString("table_time")+": "+f[d].time+"\n"+m.getString("table_size")+": "+f[d].size,e+='<div class="albumDiv"',e+=' title="',e+=g,e+='">',e+='<table class="thumb-table-parent">',e+="<tbody>",a=getFileExt(String(f[d].href)),a.length>5&&(a=""),e+="<tr><td>",e+=b=="0"?'<div class="picDiv cb" popupmenu="1" uhref="':'<div class="picDiv cb" popupmenu="0" uhref="',e+=f[d].href,e+='" data-thumb="',e+=f[d].thumb,e+='" data-name="',e+=f[d].name,e+='">',e+=
a=="jpg"||a=="jpeg"||a=="png"||a=="gif"||a=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':a=="mp3"||a=="m4a"||a=="m4r"||a=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':a=="mp4"||a=="rmvb"||a=="m4v"||a=="wmv"||a=="avi"||a=="mpg"||a=="mpeg"||a=="mkv"||a=="mov"||a=="flv"||a=="3gp"||a=="m2v"||a=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':a=="doc"||a=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':a=="ppt"||a=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':
a=="xls"||a=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':a=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':'<div id="fileviewicon" class="fileDiv bicon">',e+='<div class="selectDiv sicon"></div>',e+='<div class="selectHintDiv sicon"></div>',e+="</div></div>",e+="</td></tr>",e+="<tr><td>",e+='<div class="albuminfo" style="font-size:80%">',e+='<a id="list_item" qtype="1" isdir="0" uhref="',e+=f[d].href,e+='" title="',e+=f[d].name,e+='" matadatatitle="',e+=f[d].matadatatitle,
e+='" uid="',e+=f[d].uid,e+='" ext="',e+=a,e+='" freadonly="',e+=f[d].freadonly,e+='" fhidden="',e+=f[d].fhidden,e+='">',e+=f[d].shortname,e+="</a>",e+="</div>",e+="</td></tr>",e+="</tbody>",e+="</table>",e+="</div>";c.append(e);$(".cb").mousedown(h)}}
function createClassificationView(c,b){var d=parseXml(c);$(d);var a="";$("#main_right_container #fileview").empty();$(d).find("item").each(function(){var c=$(this).find("id").text(),d=$(this).find("title").text(),e=$(this).find("artist").text(),g=$(this).find("thumb_image").text();a+='<div class="card" data-id="'+c+'" data-no-nav="false">';a+='<div class="image-wrapper">';a+='<div class="image-inner-wrapper" id="'+b+'">';g!=""&&(a+='<img class="image" src="data:image/jpeg;base64,'+$(this).find("thumb_image").text()+
'" width="170px" height="120px" onload="javascript:DrawImage(this,170,120,true);">');a+="</div>";a+='<div class="hover-overlay"></div>';a+='<div class="overlay-icon"><div class="play bicon" data-id="'+c+'"></div></div>';a+='<div class="menu-anchor"></div>';a+="</div>";a+='<div class="details">';a+='<div class="title tooltip fade-out">'+d+"</div>";a+='<div class="sub-title tooltip fade-out" data-type="ar" data-id="'+c+'">'+e+"</div>";a+="</div>";a+="</div>"});$(a).appendTo($("#fileview")).hide().fadeIn("fast");
b=="album"?g_ui_mode.set(6):b=="artist"&&g_ui_mode.set(7);$(".mediaListDiv").removeClass("down");$("div#btnThumbView").css("display","none");$("div#btnListView").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnNewDir").css("display","none");$("div#btnPlayImage").css("display","none");$("div#boxSearch").css("display","none");adjustLayout();closeJqmWindow(0);$(".card").click(function(){var a=g_storage.get("openurl")==void 0?"/":g_storage.get("openurl");
g_storage.set("data-id",$(this).attr("data-id"));doPROPFINDMEDIALIST(a,!1,null,"2","0","50","","TIMESTAMP","DESC",$(this).attr("data-id"))});$(".card").mouseenter(function(a){$(this).find(".overlay-icon").hide().fadeIn("fast");$(this).find(".hover-overlay").fadeTo("slow",0.8);a.preventDefault();return!1});$(".card").mouseleave(function(a){$(this).find(".overlay-icon").show().fadeOut("fast");$(this).find(".hover-overlay").fadeTo("fast",0);a.preventDefault();return!1});$(".card .overlay-icon .play").click(function(a){var b=
g_storage.get("openurl"),b=b==void 0?"/":b,c=window.location.host;c.indexOf(":")!=-1&&(c=c.substring(0,c.indexOf(":")));c="http://"+c+":"+g_storage.get("http_port")+"/";client.GETMUSICPLAYLIST(b,$(this).attr("data-id"),function(a,b,d){if(a==200){a=parseXml(d);$(a);var f=[];$(a).find("item").each(function(){var a=$(this).find("title").text(),b=c+$(this).find("sharelink").text(),d=[];d.name=mydecodeURI(a);d.mp3=b;f.push(d)});openAudioPlayerByPlayList(f)}});a.preventDefault();return!1})}
function createOpenUrlUI(c){c==void 0&&(c="/");var b=mydecodeURI(c),d="",a="",f="",h=$("#urlregion-url").width();if(b!="/")for(var b=b.split("/"),c=c.split("/"),e=0;e<b.length;e++)if(!(b[e]==""||g_hide_aidisk_name==1&&b[e]==g_storage.get("usbdiskname"))){a+="/"+c[e];f+=" / <a id='url_path' uhref='"+a+"'>"+b[e]+"</a>";if(String(f).width($("p#openurl").css("font"))>h){d+=" / ...";break}d+=b[1]==g_storage.get("usbdiskname")&&g_hide_aidisk_name==1?" / <a id='url_path' uhref='/"+g_storage.get("usbdiskname")+
a+"'>"+b[e]+"</a>":" / <a id='url_path' uhref='"+a+"'>"+b[e]+"</a>";f=d}$("p#openurl").empty();$("p#openurl").append(d);$("a#url_path").click(function(){confirmCancelUploadFile()!=0&&doPROPFIND($(this).attr("uhref"))})}
function adjustLayout(){var c=getPageSize(),b=c[0],d=c[0],c=c[1]-$("#header_region").height()-$("#bottom_region").height();$("#main_region").css("height",c);$("#main_region #main_right_region").css("width",d-parseInt($("#main_region #main_right_region").css("left")));$("#main_region #main_right_region").css("height",c-parseInt($("#main_region #button_panel").height())+7);$("#main_region #button_panel").css("left",$("#main_region #main_left_region").width()-7);$("#main_region #button_panel").css("width",
$("#main_region #main_right_region").width());d=$("#main_left_region").height()-$("#main_left_region #infobar").height();$("#hostview").css("height",d);var a=0;$("#toolbar .albutton").each(function(){$(this).css("display")=="block"&&(a+=$(this).width())});$("#toolbar .alsearch").css("display")=="block"&&(a+=$("#toolbar .alsearch").width());$("#urlregion-url").css("width",$("#toolbar").width()-a-20);createOpenUrlUI(g_storage.get("openurl"));d=$("#main_right_container").height()-$("#main_right_region #infobar").height();
$("#main_right_container #hintbar").css("display")=="block"&&(d-=$("#main_right_container #hintbar").height());$("#fileview").css("height",d);$("#function_help").css("left",$("#main_left_region").width());(d=$("div#modalWindow"))&&d.css("left",(b-g_modal_window_width)/2);$("#header-fixed").css("width",$("#ntl").width());b=$("#header_region").height()+$("#main_right_region #infobar").height()+2;$("#main_right_container #hintbar").css("display")=="block"&&(b+=$("#main_right_container #hintbar").height());
$("#header-fixed").css("top",b);g_fileview_only==1&&($("#button_panel").css("display","none"),$("#main_right_region").css("left","0px"),$("#main_right_region").css("width","100%"),$("#main_right_region").css("height","100%"));$("#audio_player_panel").css("display","block")}
function showHideAiButton(c){c?g_bshowHideAiButton||($("#button_panel #btnAiMusic").fadeIn("fast"),$("#button_panel #btnAiMusicPopupMenu").fadeIn("fast"),$("#button_panel #btnAiMovie").fadeIn("fast"),$("#button_panel #btnAiPhoto").fadeIn("fast")):g_bshowHideAiButton&&($("#button_panel #btnAiMusic").fadeOut("fast"),$("#button_panel #btnAiMusicPopupMenu").fadeOut("fast"),$("#button_panel #btnAiMovie").fadeOut("fast"),$("#button_panel #btnAiPhoto").fadeOut("fast"));g_bshowHideAiButton=c}
function showHideEditUIRegion(c){c?g_bshowHideEditUIRegion||$("#button_panel #edit_ui_region").fadeIn("fast"):g_bshowHideEditUIRegion&&$("#button_panel #edit_ui_region").fadeOut("fast");g_bshowHideEditUIRegion=c}function closeAiMode(){g_storage.set("aimode",-1);$(".mediaListDiv").removeClass("down");$("div#boxSearch").css("display","none");$("div#boxSearch input").val("")}
function closeUploadPanel(c){g_upload_mode=0;g_reload_page=c;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("div#btnPlayImage").css("display","block");g_list_view.get()==1?($("div#btnListView").css("display","none"),$("div#btnThumbView").css("display","block")):($("div#btnListView").css("display","block"),$("div#btnThumbView").css("display","none"));$("div#btnCancelUpload").css("display",
"none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});c==1&&(c=addPathSlash(g_storage.get("openurl")),doPROPFIND(c))}
function cancelSelectMode(){g_select_mode!=0&&(g_select_mode=0,g_select_array=null,$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"),$("#btnDeleteSel").addClass("disable"),$("#btnRename").addClass("disable"),isAiModeView()>=0?($("div#btnNewDir").css("display","none"),$("div#btnUpload").css("display","none"),$("div#btnSelect").css("display","block"),$("div#btnPlayImage").css("display",getAiMode()==1?"block":"none"),$("div#boxSearch").css("display","block")):($("div#btnNewDir").css("display",
"block"),$("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("div#btnPlayImage").css("display","block"),$("div#boxSearch").css("display","none")),$("div#btnCancelSelect").css("display","none"),$("div#btnThumbView").css("display","block"),g_list_view.get()==1?($("div#btnThumbView").css("display","block"),$("div#btnListView").css("display","none")):($("div#btnThumbView").css("display","none"),$("div#btnListView").css("display","block")),$(".selectDiv").css("display",
"none"),$(".selectHintDiv").css("display","none"),$(".selectListDiv").css("display","none"),$(".selectListHintDiv").css("display","none"),$("#fileview #fileviewicon").each(function(){$(this).removeClass("select")}),$("#function_help").text(""),adjustLayout())}function showHideLoadStatus(c){c?$("#loading").css("display","block"):$("#loading").css("display","none")}
function show_hint_no_mediaserver(){$("#main_right_container #fileview").empty();var c=g_storage.get("http_enable"),b=g_storage.get("misc_http_enable"),d=g_storage.get("misc_http_port"),a=g_storage.get("misc_https_port"),f=window.location.host,h="http",e=d;b==0&&!isPrivateIP()?$("#main_right_container #hintbar").html(m.getString("msg_no_mediaserver")):(c=="0"?(h="http",e=d):c=="1"&&(h="https",e=a),isPrivateIP()?c=h+"://"+f.split(":")[0]:(c=h+"://"+f.split(":")[0],e!=""&&(c+=":"+e)),c+="/mediaserver.asp",
e="<a href='"+c+"' target='_blank'>"+m.getString("msg_no_mediaserver")+"</a>",$("#main_right_container #hintbar").html(e));$("#main_right_container #hintbar").show()};var g_image_player={loc:"",page_width:0,page_height:0,file_array:null,show:function(c,b,d,a){this.loc=c;this.page_width=b;this.page_height=d;this.file_array=a;c=[];for(b=0;b<this.file_array.length;b++)d=getFileExt(this.file_array[b].href),(d=="jpg"||d=="jpeg"||d=="png"||d=="gif")&&c.push(this.file_array[b]);if(c.length==0)alert(m.getString("msg_no_image_list"));else{for(b=d=0;b<c.length;b++)this.loc==c[b].href&&(d=b);a="";a+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: ';
a+=this.page_width/2;a+="px; top: ";a+=this.page_height/2;a+='px; z-index: 2999;">';a+='<div class="barousel_image">';for(b=0;b<c.length;b++){var f=window.location.protocol+"//"+window.location.host+c[b].href;a+=b==d?'<img src="" path="'+f+'" alt="" class="default"/>':'<img src="" path="'+f+'" alt="" class=""/>'}a+="</div>";a+='<div class="barousel_nav">';a+='<div class="barousel_content transparent" style="display: block; ">';for(b=0;b<c.length;b++)a+='<div class="',b==d&&(a+="default"),a+='" style="display: none; ">',
a+='<p class="header">'+c[b].name+"</p>",a+="</div>";a+="</div>";a+="</div>";a+="</div>";$(a).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({navType:2,manualCarousel:1,contentResize:0,startIndex:d});$(".facebook_upload").click(function(){var a=$("div#modalWindow"),b=$(this).attr("file"),c=myencodeURI(b.substring(b.lastIndexOf("/")+1,b.length)),b=b.substring(0,b.lastIndexOf("/")),d=window.location.host;d.indexOf(":")!=-1&&
(d=d.substring(0,d.indexOf(":")));d="http://"+d+":"+g_storage.get("http_port")+"/";client.GSL(b,b,c,0,0,function(b,e,f){b==200&&(b=parseXml(f),b=$(b).find("sharelink").text(),b=d+b,g_modal_url="http://www.efroip.com/efroip/fbtest/fb.html?v="+b+"&b="+mydecodeURI(c)+"&d="+window.location.href,g_modal_window_width=600,g_modal_window_height=320,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text("Upload to Facebook"),a&&a.jqmShow(),$("#image_slide_show").remove())})});$(".picassa_upload").click(function(){var a=
$("div#modalWindow"),b=$(this).attr("file"),c=myencodeURI(b.substring(b.lastIndexOf("/")+1,b.length)),b=b.substring(0,b.lastIndexOf("/")),d=window.location.host;d.indexOf(":")!=-1&&(d=d.substring(0,d.indexOf(":")));d="http://"+d+":"+g_storage.get("http_port")+"/";client.GSL(b,b,c,0,0,function(b,e,f){b==200&&(b=parseXml(f),b=$(b).find("sharelink").text(),b=d+b,g_modal_url="http://www.efroip.com/efroip/google/index.html?v="+b+"&b="+mydecodeURI(c)+"&d="+window.location.href,g_modal_window_width=600,
g_modal_window_height=320,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text("Upload to Facebook"),a&&a.jqmShow(),$("#image_slide_show").remove())})});c=null}}};var g_audioPlayer=null,g_audio_playlist=[],g_current_index=0,g_onPlaying=!1;function openAudioPlayer(){for(var c=[],b=0;b<g_file_array.length;b++)getFileExt(g_file_array[b].href)=="mp3"&&c.push(g_file_array[b]);if(c.length==0)alert(m.getString("msg_no_image_list"));else{for(var d="",b=0;b<c.length;b++)d+=c[b].href,b!=c.length-1&&(d+=",");get_mp3_url(d,!0,function(a){g_audioPlayer.addPlaylist(a);g_audioPlayer.showHideAudioPlayerWindow(!0)})}}
function openAudioPlayerByPlayList(c){c!=null&&!(c.length<=0)&&(g_audioPlayer.addPlaylist(c),g_audioPlayer.showHideAudioPlayerWindow(!0))}
function getAudioPlayerLayout(){var c="";c+="<div id='audioPlayerWindow' class='unselectable'>";c+='<div id="audio-player-box">';c+='<script type="text/javascript" src="/smb/js/jplayer/jquery.jplayer.min.js"><\/script>';c+='<link rel="stylesheet" href="/smb/css/jplayer.blue.monday.css" type="text/css">';c+='<div id="jquery_jplayer_1" class="jp-jplayer"></div>';c+='<div id="jp_container_1" class="jp-audio">';c+='<div class="jp-type-playlist">';c+='<div id="jp_title_1" class="jp-title">';c+="<ul>";
c+="<li>Loading...</li>";c+="</ul>";c+="</div>";c+='<div id="jp_interface_1" class="jp-gui jp-interface">';c+='<ul class="jp-controls">';c+='<li><a href="javascript:;" class="jp-previous" tabindex="1">previous</a></li>';c+='<li><a href="javascript:;" class="jp-play" tabindex="1" style="display: block; ">play</a></li>';c+='<li><a href="javascript:;" class="jp-pause" tabindex="1" style="display: block; ">pause</a></li>';c+='<li><a href="javascript:;" class="jp-next" tabindex="1">next</a></li>';c+='<li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>';
c+='<li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>';c+='<li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>';c+="</ul>";c+='<div class="jp-progress">';c+='<div class="jp-seek-bar" style="width: 100%; ">';c+='<div class="jp-play-bar" style="width: 46.700506341691536%; "></div>';c+="</div>";c+="</div>";c+='<div class="jp-volume-bar">';c+='<div class="jp-volume-bar-value" style="width: 31.979694962501526%; "></div>';
c+="</div>";c+='<div class="jp-duration-bar">';c+='<div class="jp-duration">00:00</div>';c+='<div class="jp-split">/</div>';c+='<div class="jp-current-time">00:00</div>';c+="</div>";c+="</div>";c+='<div id="jp_playlist_1" class="jp-playlist">';c+="<ul></ul>";c+="</div>";c+="</div>";c+="</div>";c+='<div class="jp-no-solution" style="display: none; ">';c+="<span>Update Required</span>";c+='To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.';
c+="</div>";c+='<a id="audio-player-box-playlist" class="sicon" href="#" rel="playlist">Playlist</a>';c+='<a id="audio-player-box-hide" class="sicon" href="#" rel="close">Hide</a>';c+='<a id="audio-player-box-close" class="sicon" href="#" rel="close">Close</a>';c+="</div>";c+="</div>";c+="<div id='audioPlayerStatusWindow' class='bicon' style='display:none'>";c+="<div id='close-button'></div>";c+="<div id='status-bar'>";c+="<span id='status'></span>";c+="</div>";c+="</div>";return c}
function get_mp3_url(c,b,d){if(c!=""){var a=[],f=c.split(","),h=0,e=!1;if(b){var g=window.location.host;g.indexOf(":")!=-1&&(g=g.substring(0,g.indexOf(":")));var g="http://"+g+":"+g_storage.get("http_port")+"/",j=setInterval(function(){if(e==!1)if(h<0||h>f.length-1)clearInterval(j),d(a);else{var b=f[h],c=b.substring(b.lastIndexOf("/")+1,b.length),b=b.substring(0,b.lastIndexOf("/"));e=!0;client.GSL(b,b,c,0,0,function(b,d,f){if(b==200)b=parseXml(f),b=$(b).find("sharelink").text(),b=g+b,e=!1,d=[],d.name=
mydecodeURI(c),d.mp3=b,a.push(d),h++})}},100)}else{for(c=0;c<f.length;c++){var b=f[c],k=b.substring(b.lastIndexOf("/")+1,b.length);b.substring(0,b.lastIndexOf("/"));var l=[];l.name=mydecodeURI(k);l.mp3=b;a.push(l)}d(a)}}}
function initAudioPlayer(){var c=function(a,b){var c=this;this.statusMarqueeTimer=this.clsoeAudioPlayerWindowTimer=0;this.instance=a;this.playlist=null;this.options=b;this.playTitle="";this.current=0;this.showAudioList=!1;this.cssId={jPlayer:"jquery_jplayer_","interface":"jp_interface_",playlist:"jp_playlist_",playtitle:"jp_title_"};this.cssSelector={};$.each(this.cssId,function(a,b){c.cssSelector[a]="#"+b+c.instance});this.options.cssSelectorAncestor||(this.options.cssSelectorAncestor=this.cssSelector["interface"]);
$(this.cssSelector.jPlayer).jPlayer(this.options);var d=this.cssSelector["interface"]+" .jp-previous";$(d).click(function(){c.playlistPrev();$(this).blur();return!1});d=this.cssSelector["interface"]+" .jp-next";$(d).click(function(){c.playlistNext();$(this).blur();return!1});$("#audioPlayerWindow").mousemove(function(){c.startStopRunAudioPlayerWindowTimer(!1)});$("#audioPlayerWindow").mouseleave(function(){c.startStopRunAudioPlayerWindowTimer(!0)});$("#audio-player-box-hide").click(function(){c.showHideAudioPlayerWindow(!1);
return!1});$("#audio-player-box-close").click(function(){if(g_onPlaying&&!confirm(m.getString("msg_close_audio_window_warning")))return!1;c.closeAudioPlayWindow();return!1});$("#audio-player-box-playlist").click(function(){c.showHideAudioList(!c.showAudioList)});$("#audioPlayerStatusWindow").click(function(){c.showHideAudioPlayerWindow(!0)});$("#audioPlayerStatusWindow #close-button").click(function(){if(g_onPlaying&&!confirm(m.getString("msg_close_audio_window_warning")))return!1;c.closeAudioPlayWindow();
return!1})};c.prototype={getPlayTitle:function(){return this.playTitle},startStopRunAudioPlayerStatus:function(a){a?$("#audioPlayerStatusWindow").fadeIn("slow",function(){this.statusMarqueeTimer=setInterval(function(){var a=String($("#audioPlayerStatusWindow #status").text()).width($("#audioPlayerStatusWindow #status").css("font"));$("#audioPlayerStatusWindow #status").animate({left:-a},5E3,function(){$("#audioPlayerStatusWindow #status").css("left",80)})},500)}):(clearInterval(this.statusMarqueeTimer),
$("#audioPlayerStatusWindow").css("display","none"))},startStopRunAudioPlayerWindowTimer:function(a){var b=this;a?b.clsoeAudioPlayerWindowTimer=setTimeout(function(){b.showHideAudioPlayerWindow(!1)},1E4):clearInterval(b.clsoeAudioPlayerWindowTimer)},showHideAudioPlayerWindow:function(a){var b=this;a?(b.startStopRunAudioPlayerWindowTimer(!1),b.startStopRunAudioPlayerStatus(!1),$("#audioPlayerWindow").fadeIn(500,function(){b.startStopRunAudioPlayerWindowTimer(!0)})):$("#audioPlayerWindow").fadeOut(500,
function(){b.startStopRunAudioPlayerStatus(!0);b.showHideAudioList(!1)})},showHideAudioInterface:function(a){a?$("#jp_interface_1").css("display","block"):$("#jp_interface_1").css("display","none")},showHideAudioList:function(a){a?$(".jp-playlist").css("display","block"):$(".jp-playlist").css("display","none");this.showAudioList=a},setPlaylist:function(a){this.playlist=a;this.displayPlaylist();this.current=g_current_index;this.playlistInit(!0);$("#playlist").css("visibility","visible");this.showHideAudioInterface(!0);
this.showHideAudioList(!1)},addPlaylist:function(a){this.playlist=a;this.displayPlaylist();this.current=g_current_index;this.playlistInit(!0);$("#playlist").css("visibility","visible");this.showHideAudioInterface(!0);this.showHideAudioList(!1)},displayPlaylist:function(){if(!(this.playlist==null||this.playlist==void 0)){var a=this;$(this.cssSelector.playlist+" ul").empty();for(i=0;i<this.playlist.length;i++){var b=i===this.playlist.length-1?"<li class='jp-playlist-last'>":"<li>";b+="<a href='#' id='"+
this.cssId.playlist+this.instance+"_item_"+i+"' tabindex='1'>"+this.playlist[i].name+"</a>";$(this.cssSelector.playlist+" ul").append(b);$(this.cssSelector.playlist+"_item_"+i).data("index",i).click(function(){var b=$(this).data("index");a.current!==b?a.playlistChange(b):$(a.cssSelector.jPlayer).jPlayer("play");$(this).blur();return!1})}}},playlistInit:function(a){a?this.playlistChange(this.current):this.playlistConfig(this.current)},playlistConfig:function(a){$(this.cssSelector.playlist+"_item_"+
this.current).removeClass("jp-playlist-current").parent().removeClass("jp-playlist-current");$(this.cssSelector.playlist+"_item_"+a).addClass("jp-playlist-current").parent().addClass("jp-playlist-current");this.current=parseInt(a);var b=a=this.playlist[this.current].name,c=$(this.cssSelector.playtitle+" li").width(),d=String(a).width($(this.cssSelector.playtitle+" li").css("font"));this.playTitle=a;if(d>c){for(var d=getFileExt(a),j=a.length,k="",l=0,l=0;l<j;l++)if(k+=a[l],String(k+"."+d).width($(this.cssSelector.playtitle+
" li").css("font"))>c)break;a=a.substring(0,l-4)+"...."+d}$(this.cssSelector.playtitle+" li").attr("title",b);$(this.cssSelector.playtitle+" li").text(a);$(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[this.current])},playlistChange:function(a){this.playlistConfig(a);$(this.cssSelector.jPlayer).jPlayer("play")},playlistNext:function(){this.playlistChange(this.current+1<this.playlist.length?this.current+1:0)},playlistPrev:function(){this.playlistChange(this.current-1>=0?this.current-1:
this.playlist.length-1)},closeAudioPlayWindow:function(){$(this.cssSelector.jPlayer).jPlayer("stop");this.startStopRunAudioPlayerStatus(!1);this.startStopRunAudioPlayerWindowTimer(!1);$("#audioPlayerStatusWindow").hide();$("#audioPlayerWindow").hide()}};var b="html,flash",d="mp3",a=navigator.userAgent;if(a.indexOf("Chrome")!=-1||a.indexOf("Safari")!=-1&&(isMacOS()||isWinOS()))b="html",d="mp3";else if(a.indexOf("MSIE")!=-1||a.indexOf("Firefox")!=-1||a.indexOf("Opera")!=-1)b="flash",d="mp3";g_audioPlayer=
new c("1",{ready:function(){},ended:function(){g_audioPlayer.playlistNext();g_storage.set("stopLogoutTimer","0")},play:function(){$(this).jPlayer("pauseOthers");g_storage.set("stopLogoutTimer","1")},playing:function(){$("#audioPlayerStatusWindow #status").text("playing: "+g_audioPlayer.getPlayTitle());g_onPlaying=!0;g_storage.set("stopLogoutTimer","1")},pause:function(){$("#audioPlayerStatusWindow #status").text("pause: "+g_audioPlayer.getPlayTitle());g_onPlaying=!1;g_storage.set("stopLogoutTimer",
"0")},stop:function(){g_onPlaying=!1;g_storage.set("stopLogoutTimer","0")},swfPath:"/smb/js/jplayer/",supplied:d,solution:b,wmode:"window",errorAlerts:!1,warningAlerts:!1,error:function(a){a.jPlayer.error.type=="e_no_solution"&&($(".jp-no-solution").html(m.getString("title_install_flash")),$(".jp-no-solution").css("display","block"))}})};var g_thumb_loader={_container:null,_timer:null,_array:null,_onLoading:!1,init:function(c){var b=this;this._container=c;this.stop();this._array=[];c="picDiv";g_list_view.get()==1&&(c="listDiv");this._container.find("."+c).each(function(){$(this).attr("data-thumb")==1&&b._array.push({item_con:$(this).find("#fileviewicon"),uhref:$(this).attr("uhref"),filename:$(this).attr("data-name")})})},setImage:function(c,b){var d='<img src="data:image/jpeg;base64,'+b+'" width="80px" height="60px" onload="javascript:DrawImage(this,80,60);"></img>';
c.attr("class","");$(d).appendTo(c)},start:function(){var c=this;if(!(this._array.length<=0))this._timer=setInterval(function(){if(c._array.length<=0)clearInterval(c._timer);else if(c._onLoading!=!0){c._onLoading=!0;var b=c._array[0],d=b.item_con,a=b.uhref,b=b.filename,f=g_storage.get("openurl")==void 0?"/":g_storage.get("openurl"),a=g_storage.getl(a);a!=void 0&&a!=""?(c.setImage(d,a),c._array.shift(),c._onLoading=!1):client.GETTHUMBIMAGE(f,b,function(a,b,f){a==200&&(a=parseXml(f),a=$(a).find("thumb_image").text(),
a!=""&&c.setImage(d,a));c._array.shift();c._onLoading=!1})}},100)},stop:function(){this._array=null;clearInterval(this._timer)}};
